<!DOCTYPE html>
<html>
<head>
  <title>Word Translator</title>
</head>
<body>
<h1>Word Translator</h1>
<div>
  <input type="file" id="fileInput" accept=".json" onchange="handleFileInput(event)">
  <button onclick="loadWords()">Load Words</button>
</div>
<div>
  <p id="wordDisplay"></p>
  <button onclick="toggleSynonyms()">Toggle Synonyms</button>
  <button onclick="nextWord()">Next Word</button>
  <button onclick="displayTranslation()">Show Translation</button>
  <button onclick="toggleShowSynonyms()">Show/Hide Synonyms</button>
</div>
<div>
  <input type="text" id="newWord" placeholder="Enter English word">
  <input type="text" id="newTranslation" placeholder="Enter Russian translation">
  <input type="text" id="newSynonyms" placeholder="Enter synonyms separated by commas">
  <button onclick="addWordPair()">Add Word Pair</button>
</div>
<div>
  <button onclick="toggleShowAllWords()">Show/Hide All Words</button>
</div>
<div id="errorMessage"></div>
<div id="wordList" style="display: none;"></div>
<div id="editForm" style="display: none;">
  <h2>Edit Word Pair</h2>
  <input type="text" id="editEnglishWord" placeholder="English word">
  <input type="text" id="editRussianTranslation" placeholder="Russian translation">
  <div id="editSynonyms">
    <input type="text" class="synonymField" placeholder="Synonym">
    <button onclick="addSynonymField()">Add Synonym</button>
  </div>
  <button onclick="saveEditedWordPair()">Save</button>
  <button onclick="cancelEdit()">Cancel</button>
</div>
<script>
  // Object for both word pairs and synonyms
  let wordData = {
    "hello": {
      translation: "привет",
      synonyms: ["hi", "hey", "greetings"]
    },
    "world": {
      translation: "мир",
      synonyms: ["earth", "globe", "planet"]
    },
    "goodbye": {
      translation: "пока",
      synonyms: ["farewell", "bye", "see you"]
    },
    "house": {
      translation: "дом",
      synonyms: ["home", "residence", "dwelling"]
    },
    // Add more word pairs as needed
  };

  let showSynonyms = true;
  let showTranslationMode = false;
  let currentIndex = 0;
  let showAllWordsFlag = false;

  function getRandomWord() {
    const words = Object.keys(wordData);
    const randomIndex = Math.floor(Math.random() * words.length);
    return words[randomIndex];
  }

  function displayWord() {
    const wordDisplay = document.getElementById("wordDisplay");
    const word = Object.keys(wordData)[currentIndex];

    if (showTranslationMode) {
      const synonymsDisplay = showSynonyms ? `- ${wordData[word].synonyms.join(", ")}` : "";
      wordDisplay.innerHTML = `<strong>${word}</strong> ${synonymsDisplay} - ${wordData[word].translation}`;
    } else {
      wordDisplay.innerText = showSynonyms ? `${word} - ${wordData[word].synonyms.join(", ")}` : word;
    }
  }

  function toggleSynonyms() {
    showSynonyms = !showSynonyms;
    displayWord();
  }

  function toggleShowSynonyms() {
    showSynonyms = !showSynonyms;
    displayWord();
  }

  function nextWord() {
    currentIndex = (currentIndex + 1) % Object.keys(wordData).length;
    showTranslationMode = false; // Reset to default
    displayWord();
  }

  function displayTranslation() {
    showTranslationMode = true;
    displayWord();
  }

  function addWordPair() {
    const newWordInput = document.getElementById("newWord");
    const newTranslationInput = document.getElementById("newTranslation");
    const newSynonymsInput = document.getElementById("newSynonyms");
    const newWord = newWordInput.value.trim().toLowerCase();
    const newTranslation = newTranslationInput.value.trim();
    const newSynonyms = newSynonymsInput.value.split(",").map(synonym => synonym.trim().toLowerCase());

    if (newWord !== "" && newTranslation !== "") {
      wordData[newWord] = {
        translation: newTranslation,
        synonyms: []
      };

      for (const synonym of newSynonyms) {
        if (wordData.hasOwnProperty(synonym)) {
          wordData[newWord].synonyms.push(synonym);
        } else {
          const errorMessageDiv = document.getElementById("errorMessage");
          errorMessageDiv.innerText = `Warning: Synonym "${synonym}" doesn't exist as an English word. It will not be added.`;
          setTimeout(() => {
            errorMessageDiv.innerText = ""; // Clear the error message after a few seconds
          }, 3000);
        }
      }

      newWordInput.value = "";
      newTranslationInput.value = "";
      newSynonymsInput.value = "";

      displayWord(); // Update the displayed word after adding new word pair
    }
  }

  function toggleShowAllWords() {
    const wordListDiv = document.getElementById("wordList");
    if (showAllWordsFlag) {
      wordListDiv.style.display = "none";
      const editFormDiv = document.getElementById("editForm");
      editFormDiv.style.display = "none";
    } else {
      wordListDiv.style.display = "block";
      showAllWords();
    }
    showAllWordsFlag = !showAllWordsFlag;
  }

  function showAllWords() {
    const wordListDiv = document.getElementById("wordList");
    let wordListHTML = '<h2>All Word Pairs</h2>';

    for (const word in wordData) {
      wordListHTML += `
        <div>
          <strong>${word}</strong> - ${wordData[word].translation}
          <button onclick="editWordPair('${word}')">Edit</button>
        </div>
      `;
    }

    wordListDiv.innerHTML = wordListHTML;
  }

  function toggleEditForm() {
    const editFormDiv = document.getElementById("editForm");
    editFormDiv.style.display = editFormDiv.style.display === "block" ? "none" : "block";
  }

  function editWordPair(word) {
    const editEnglishWordInput = document.getElementById("editEnglishWord");
    const editRussianTranslationInput = document.getElementById("editRussianTranslation");
    const editSynonymsDiv = document.getElementById("editSynonyms");

    editEnglishWordInput.value = word;
    editRussianTranslationInput.value = wordData[word].translation;
    editSynonymsDiv.innerHTML = "";

    for (const synonym of wordData[word].synonyms) {
      const synonymField = document.createElement("input");
      synonymField.type = "text";
      synonymField.className = "synonymField";
      synonymField.value = synonym;

      const deleteButton = document.createElement("button");
      deleteButton.innerText = "Delete";
      deleteButton.onclick = function () {
        editSynonymsDiv.removeChild(synonymField);
        editSynonymsDiv.removeChild(deleteButton);
      };

      editSynonymsDiv.appendChild(synonymField);
      editSynonymsDiv.appendChild(deleteButton);
    }

    const addSynonymButton = document.createElement("button");
    addSynonymButton.innerText = "Add Synonym";
    addSynonymButton.onclick = function () {
      addSynonymField(editSynonymsDiv);
    };

    editSynonymsDiv.appendChild(addSynonymButton);

    toggleEditForm();
  }

  function addSynonymField(parentDiv) {
    const synonymField = document.createElement("input");
    synonymField.type = "text";
    synonymField.className = "synonymField";

    const deleteButton = document.createElement("button");
    deleteButton.innerText = "Delete";
    deleteButton.onclick = function () {
      parentDiv.removeChild(synonymField);
      parentDiv.removeChild(deleteButton);
    };

    parentDiv.insertBefore(synonymField, parentDiv.lastChild);
    parentDiv.insertBefore(deleteButton, parentDiv.lastChild);
  }

  function saveEditedWordPair() {
    const editEnglishWordInput = document.getElementById("editEnglishWord");
    const editRussianTranslationInput = document.getElementById("editRussianTranslation");
    const editSynonymFields = document.getElementsByClassName("synonymField");

    const editedWord = editEnglishWordInput.value.trim().toLowerCase();
    const editedTranslation = editRussianTranslationInput.value.trim();
    const editedSynonyms = [];

    for (const field of editSynonymFields) {
      editedSynonyms.push(field.value.trim().toLowerCase());
    }

    if (editedWord !== "" && editedTranslation !== "") {
      wordData[editedWord] = {
        translation: editedTranslation,
        synonyms: editedSynonyms
      };

      // If the word has been changed, delete the old word entry
      const currentWord = Object.keys(wordData)[currentIndex];
      if (editedWord !== currentWord) {
        delete wordData[currentWord];
      }

      const editFormDiv = document.getElementById("editForm");
      editFormDiv.style.display = "none";
      showAllWords();
    }
  }

  function cancelEdit() {
    const editFormDiv = document.getElementById("editForm");
    editFormDiv.style.display = "none";
  }

  // Function to handle the file input and read JSON data
  function handleFileInput(event) {
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = function () {
      const jsonData = JSON.parse(reader.result);
      if (typeof jsonData === 'object') {
        wordData = jsonData;
        currentIndex = 0; // Reset the current index to 0 after loading new word pairs
        showAllWordsFlag = false; // Hide the word list if open
        displayWord(); // Display the first word from the loaded data
      } else {
        console.error("Invalid JSON format.");
      }
    };

    reader.readAsText(file);
  }

  // Function to load words from the wordData object
  function loadWords() {
    const fileInput = document.getElementById("fileInput");
    fileInput.click();
  }

  // Initial display
  displayWord();
</script>
</body>
</html>
