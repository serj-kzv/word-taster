<!DOCTYPE html>
<html>
<head>
  <title>Word Translator</title>
</head>
<body>
<h1>Word Translator</h1>
<div>
  <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="loadWordsFromFile(event)">
  <button onclick="openFile()">Load Words</button>
  <button onclick="saveWords()">Save Words</button>
</div>
<div>
  <p id="wordDisplay"></p>
  <button onclick="toggleSynonyms()">Toggle Synonyms</button>
  <button onclick="nextWord()">Next Word</button>
  <button onclick="displayTranslation()">Show Translation</button>
  <button onclick="toggleShowSynonyms()">Show/Hide Synonyms</button>
</div>
<div>
  <input type="text" id="newWord" placeholder="Enter English word">
  <input type="text" id="newTranslation" placeholder="Enter Russian translation">
  <input type="text" id="newSynonyms" placeholder="Enter synonyms separated by commas">
  <button onclick="addWordPair()">Add Word Pair</button>
</div>
<div>
  <button onclick="toggleShowAllWords()">Show/Hide All Words</button>
</div>
<div id="errorMessage"></div>
<div id="wordList" style="display: none;"></div>
<div id="editForm" style="display: none;"></div>
<script>
  // Object for both word pairs and synonyms
  let wordData = {
    "hello": {
      translation: "привет",
      synonyms: ["hi", "hey", "greetings"]
    },
    "world": {
      translation: "мир",
      synonyms: ["earth", "globe", "planet"]
    },
    "goodbye": {
      translation: "пока",
      synonyms: ["farewell", "bye", "see you"]
    },
    "house": {
      translation: "дом",
      synonyms: ["home", "residence", "dwelling"]
    },
    // Add more word pairs as needed
  };

  let showSynonyms = true;
  let showTranslationMode = false;
  let currentIndex = 0;
  let showAllWordsFlag = false;

  function getRandomWord() {
    const words = Object.keys(wordData);
    const randomIndex = Math.floor(Math.random() * words.length);
    return words[randomIndex];
  }

  function displayWord() {
    const wordDisplay = document.getElementById("wordDisplay");
    const word = Object.keys(wordData)[currentIndex];

    if (showTranslationMode) {
      const synonymsDisplay = showSynonyms ? `- ${wordData[word].synonyms.join(", ")}` : "";
      wordDisplay.innerHTML = `<strong>${word}</strong> ${synonymsDisplay} - ${wordData[word].translation}`;
    } else {
      wordDisplay.innerText = showSynonyms ? `${word} - ${wordData[word].synonyms.join(", ")}` : word;
    }
  }

  function toggleSynonyms() {
    showSynonyms = !showSynonyms;
    displayWord();
  }

  function toggleShowSynonyms() {
    showSynonyms = !showSynonyms;
    displayWord();
  }

  function nextWord() {
    currentIndex = (currentIndex + 1) % Object.keys(wordData).length;
    showTranslationMode = false; // Reset to default
    displayWord();
  }

  function displayTranslation() {
    showTranslationMode = true;
    displayWord();
  }

  function addWordPair() {
    const newWordInput = document.getElementById("newWord");
    const newTranslationInput = document.getElementById("newTranslation");
    const newSynonymsInput = document.getElementById("newSynonyms");
    const newWord = newWordInput.value.trim().toLowerCase();
    const newTranslation = newTranslationInput.value.trim();
    const newSynonyms = newSynonymsInput.value.split(",").map(synonym => synonym.trim().toLowerCase());

    if (newWord !== "" && newTranslation !== "") {
      wordData[newWord] = {
        translation: newTranslation,
        synonyms: []
      };

      for (const synonym of newSynonyms) {
        if (wordData.hasOwnProperty(synonym)) {
          wordData[newWord].synonyms.push(synonym);
        } else {
          const errorMessageDiv = document.getElementById("errorMessage");
          errorMessageDiv.innerText = `Warning: Synonym "${synonym}" doesn't exist as an English word. It will not be added.`;
          setTimeout(() => {
            errorMessageDiv.innerText = ""; // Clear the error message after a few seconds
          }, 3000);
        }
      }

      newWordInput.value = "";
      newTranslationInput.value = "";
      newSynonymsInput.value = "";

      displayWord(); // Update the displayed word after adding new word pair
    }
  }

  function toggleShowAllWords() {
    const wordListDiv = document.getElementById("wordList");
    if (showAllWordsFlag) {
      wordListDiv.style.display = "none";
      const editFormDiv = document.getElementById("editForm");
      editFormDiv.style.display = "none";
    } else {
      wordListDiv.style.display = "block";
      showAllWords();
    }
    showAllWordsFlag = !showAllWordsFlag;
  }

  function showAllWords() {
    const wordListDiv = document.getElementById("wordList");
    let wordListHTML = '<h2>All Word Pairs</h2>';

    for (const word in wordData) {
      wordListHTML += `
        <div>
          <strong>${word}</strong> - ${wordData[word].translation}
          <button onclick="toggleEditForm('${word}')">Edit</button>
          <div id="editForm_${word}" style="display: none;">
            <input type="text" class="editEnglishWord" placeholder="English word" value="${word}">
            <input type="text" class="editRussianTranslation" placeholder="Russian translation" value="${wordData[word].translation}">
            <div id="editSynonyms_${word}">
              ${generateSynonymFields(word)}
            </div>
            <button onclick="addSynonymField('editSynonyms_${word}')">Add Synonym</button>
            <button onclick="saveEditedWordPair('${word}')">Save</button>
            <button onclick="cancelEdit('${word}')">Cancel</button>
          </div>
        </div>
      `;
    }

    wordListDiv.innerHTML = wordListHTML;
  }

  function toggleEditForm(word) {
    const editFormDiv = document.getElementById(`editForm_${word}`);
    editFormDiv.style.display = editFormDiv.style.display === "none" ? "block" : "none";
  }

  function generateSynonymFields(word) {
    let synonymFieldsHTML = "";
    for (const synonym of wordData[word].synonyms) {
      synonymFieldsHTML += `
        <input type="text" class="synonymField" placeholder="Synonym" value="${synonym}">
        <button onclick="deleteSynonymField(this)">Delete</button>
      `;
    }
    return synonymFieldsHTML;
  }

  function addSynonymField(parentId) {
    const parentDiv = document.getElementById(parentId);
    const synonymField = document.createElement("input");
    synonymField.type = "text";
    synonymField.className = "synonymField";

    const deleteButton = document.createElement("button");
    deleteButton.innerText = "Delete";
    deleteButton.onclick = function () {
      deleteSynonymField(this);
    };

    parentDiv.insertBefore(synonymField, parentDiv.lastChild);
    parentDiv.insertBefore(deleteButton, parentDiv.lastChild);
  }

  function deleteSynonymField(deleteButton) {
    const parentDiv = deleteButton.parentNode;
    parentDiv.removeChild(deleteButton); // Remove the delete button
    parentDiv.removeChild(parentDiv.lastChild); // Remove the corresponding input field
  }

  function saveEditedWordPair(word) {
    const editFormDiv = document.getElementById(`editForm_${word}`);
    const editEnglishWordInput = editFormDiv.querySelector(".editEnglishWord");
    const editRussianTranslationInput = editFormDiv.querySelector(".editRussianTranslation");
    const editSynonymFields = editFormDiv.getElementsByClassName("synonymField");

    const editedWord = editEnglishWordInput.value.trim().toLowerCase();
    const editedTranslation = editRussianTranslationInput.value.trim();
    const editedSynonyms = [];

    for (const field of editSynonymFields) {
      editedSynonyms.push(field.value.trim().toLowerCase());
    }

    if (editedWord !== "" && editedTranslation !== "") {
      wordData[editedWord] = {
        translation: editedTranslation,
        synonyms: editedSynonyms
      };

      // If the word has been changed, delete the old word entry
      if (editedWord !== word) {
        delete wordData[word];
      }

      toggleEditForm(word);
      showAllWords();
    }
  }

  function cancelEdit(word) {
    toggleEditForm(word);
  }

  function openFile() {
    const fileInput = document.getElementById("fileInput");
    fileInput.click();
  }

  // Function to handle the file input and read JSON data
  function loadWordsFromFile(event) {
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = function () {
      const jsonData = JSON.parse(reader.result);
      if (typeof jsonData === 'object') {
        wordData = jsonData;
        currentIndex = 0; // Reset the current index to 0 after loading new word pairs
        showAllWordsFlag = false; // Hide the word list if open
        displayWord(); // Display the first word from the loaded data
      } else {
        console.error("Invalid JSON format.");
      }
    };

    reader.readAsText(file);
  }

  // Function to save words to a JSON file
  function saveWords() {
    const jsonData = JSON.stringify(wordData, null, 2);
    const blob = new Blob([jsonData], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "wordPairs.json";
    a.click();

    URL.revokeObjectURL(url);
  }

  // Initial display
  displayWord();
</script>
</body>
</html>
